# 数据集采架构设计中的一些问题思考

### 时间轴：  
* [20191106](#20191106)
  * [接口调用统计信息实现](#接口调用统计信息实现)


### 20191106
#### 接口调用统计信息实现
`关于接口调用统计信息如何设计？`  

一般来说接口调用统计的信息包括以下内容：
```
  调用的接口、调用具体的方法、统计调用总次数、调用耗时情况、调用状态、入参和出参
```
1.1、接口调用信息如何统计：
```
  采用AOP的思想，通过SPI或拦截器的方式，在方法调用前可以打印调用日志，也可以往数据库、redis、内存等插入调用情况，
在调用方法结束后统计耗时情况，出参，回写调用状态为成功，失败的话回写调用状态为失败，
  
  AOP的问题在于是同步的
  异步如何实现 Todo
```
```
  使用同步方式还是异步方式调用，可以通过设置参数进行配置，
  比如inteface.statistics.model=sync,async
```
1.2、调用总次数的统计如何实现：
```
  可以通过 AtomicInteger 或 LongAdder来解决并发情况下统计次数不准确的情况。
  
  也可以通过单服务的Redis的自增特性来实现
```
```
  使用原子操作类还是使用Redis 可以通过设定参数进行配置，
  比如：inteface.statistics.total=atomic,redis
```

