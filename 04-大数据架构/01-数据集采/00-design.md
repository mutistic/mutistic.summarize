# 数据集采架构设计中的一些问题思考

### 目录：  
* [接口调用统计信息实现](#接口调用统计信息实现)
* [浅析 数据集采](#浅析-数据集采)
* [浅析 数据集市](#浅析-数据集市)
* [浅析 负载均衡](#浅析-负载均衡)
* [浅析 网关](#浅析-网关)
* [浅析 服务注册](#浅析-服务注册)
* [浅析 服务发现](#浅析-服务发现)
* [浅析 服务治理](#浅析-服务治理)
* [浅析 任务调度](#浅析-任务调度)
* [浅析 数据存储](#浅析-数据存储)

### 接口调用统计信息实现
`关于接口调用统计信息如何设计？`  

一般来说接口调用统计的信息包括以下内容：
```
  调用的接口、调用具体的方法、统计调用总次数、调用耗时情况、调用状态、入参和出参
```
1、接口调用信息如何统计：
```
  采用AOP的思想，通过SPI或拦截器的方式，在方法调用前可以打印调用日志，也可以往数据库、redis、内存等插入调用情况，
在调用方法结束后统计耗时情况，出参，回写调用状态为成功，失败的话回写调用状态为失败，
  
  AOP的问题在于是同步的
  异步如何实现 Todo
```
```
  使用同步方式还是异步方式调用，可以通过设置参数进行配置，
  比如inteface.statistics.model=sync,async
```
2、调用总次数的统计如何实现：
```
  可以通过 AtomicInteger 或 LongAdder来解决并发情况下统计次数不准确的情况。
  
  也可以通过单服务的Redis的自增特性来实现
```
```
  使用原子操作类还是使用Redis 可以通过设定参数进行配置，
  比如：inteface.statistics.total=atomic,redis
```

### 浅析 数据集采
1、外源数据对接协议统一问题  
2、对内服务接口提供归一问题  

### 浅析 数据集市
1、数据集市粒度划分问题  
2、数据链路问题

### 浅析 负载均衡
1、Nginx 服务端负载均衡  
2、Feigh 客户端负载均衡（基于Ribbon）  
3、Ribbon  

### 浅析 网关
1、Zuul

### 浅析 服务注册
1、dubbo + zk(redis/db)  
2、Eueka（AP）1.9.13，（2.x停止维护）  
3、consul（CA）

### 浅析 服务发现
1、Feigh代理  
2、dubbo

### 浅析 服务治理
1、Hystix：限流、熔断.....  
2、服务统计  
3、

### 浅析 任务调度
1、xxl-job：轻量、文档、界面（基于Quartz）  
2、elasstic-job；zk+mesos  
3、Quartz

### 浅析 数据存储
1、MongoDB(JSON，数据集市)  
2、HBase  
3、Redis  
4、ES  
5、MySQL  